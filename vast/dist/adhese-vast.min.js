function AdheseVastWrapper(e){this.debug=void 0!=e?e:!1}function AdheseVastAd(e,t,r,s,n,i,a){this.id=e,this.mediafile=t,this.duration=r,this.impression=s,this.durationInSeconds=n,this.trackers=i,this.click=a}function AdheseVastMediaFile(e,t){this.src=e,this.type=t}function AdheseVastEventListener(e,t){this.event=e,this.listener=t}function AdheseVastHelper(){}AdheseVastWrapper.prototype.init=function(){this.eventListeners=new Array,this.trackedImpressions=new Array,this.schedule={},this.helper=new AdheseVastHelper},AdheseVastWrapper.prototype.requestAds=function(e,t,r){var s=e+"/jsonp/a.parseVastJson";for(var n in r)s+="/sl"+t+"-"+r[n];s+="/?t="+(new Date).getTime();var i=document.createElement("script");i.type="text/javascript",i.src=s,document.getElementsByTagName("head")[0].appendChild(i)},AdheseVastWrapper.prototype.parseInLine=function(e){for(var t=new Array,r=e.getElementsByTagName("MediaFile"),s=0;s<r.length;s++)t.push(new AdheseVastMediaFile(r[s].firstChild.nodeValue,r[s].attributes.getNamedItem("type").nodeValue));for(var n=new Array,i=e.getElementsByTagName("Impression"),s=0;s<i.length;s++)n.push(i[s].firstChild.nodeValue);for(var a=new Object,o=e.getElementsByTagName("Tracking"),s=0;s<o.length;s++)a[o[s].attributes.getNamedItem("event").nodeValue]||(a[o[s].attributes.getNamedItem("event").nodeValue]=new Array),a[o[s].attributes.getNamedItem("event").nodeValue].push(o[s].firstChild.nodeValue);for(var d=e.getElementsByTagName("ClickTracking"),s=0;s<o.length;s++)a.click||(a.click=new Array),d[s]&&d[s].firstChild.nodeValue&&""!=d[s].firstChild.nodeValue&&a.click.push(d[s].firstChild.nodeValue);for(var h="",l=e.getElementsByTagName("ClickThrough"),s=0;s<l.length;s++)h=l[s].firstChild.nodeValue;var p=e.attributes.getNamedItem("code")?e.attributes.getNamedItem("code").nodeValue:"preroll";this.debug&&console.log(p),this.schedule[p]=new AdheseVastAd(p,t,e.getElementsByTagName("Duration")[0].firstChild.nodeValue,n,this.helper.getDurationInSeconds(e.getElementsByTagName("Duration")[0].firstChild.nodeValue),a,h),this.debug&&console.log(this.schedule)},AdheseVastWrapper.prototype.parseVastJson=function(e){for(var t=this.parseXML(e[0].tag),r=t.getElementsByTagName("Ad"),s=this,n=0;n<r.length;n++)if(r[n].getElementsByTagName("InLine").length>0)this.parseInLine(r[n]);else{var i=r[n].attributes.getNamedItem("code").nodeValue,a=r[n].getElementsByTagName("Impression");AdheseAjax.request({url:r[n].getElementsByTagName("VASTAdTagURI")[0].firstChild.nodeValue,method:"get",json:!1}).done(function(e){for(var t=s.parseXML(e),r=t.getElementsByTagName("Ad"),n=0;n<r.length;n++){r[n].setAttribute("code",i);for(var o=0;o<a.length;o++)r[n].getElementsByTagName("InLine")[0].insertBefore(a[o],r[n].getElementsByTagName("Impression")[0]);r[n].getElementsByTagName("InLine").length>0?s.parseInLine(r[n]):s.debug&&console.log("Too many redirects")}s.fireAdsLoaded()})}this.fireAdsLoaded()},AdheseVastWrapper.prototype.parseXML=function(e){if(this.debug&&console.log(typeof window.DOMParser),"undefined"!=typeof window.DOMParser)return(new window.DOMParser).parseFromString(e,"text/xml");if("undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}return void 0},AdheseVastWrapper.prototype.addEventListener=function(e,t){this.eventListeners.push(new AdheseVastEventListener(e,t))},AdheseVastWrapper.prototype.fireAdsLoaded=function(){for(var e=0;e<this.eventListeners.length;e++)"ADS_LOADED"==this.eventListeners[e].getEvent()&&(this.debug&&console.log("ADS_LOADED sent to listener"),this.eventListeners[e].getListener().apply())},AdheseVastWrapper.prototype.getSchedule=function(){var e=new Array;for(var t in this.schedule)e.push(t);return e},AdheseVastWrapper.prototype.hasAd=function(e){return void 0!=this.schedule[e]},AdheseVastWrapper.prototype.getImpression=function(e){return this.schedule[e].getImpression()},AdheseVastWrapper.prototype.getClick=function(e){return this.schedule[e].getClick()},AdheseVastWrapper.prototype.getTrackers=function(e){return this.schedule[e].getTrackers()},AdheseVastWrapper.prototype.getMediafile=function(e,t){for(var r=this.schedule[e].getMediafile(),s=0;s<r.length;s++)if(r[s].getType()==t)return r[s].getSrc();return void 0},AdheseVastWrapper.prototype.getDuration=function(e){return this.schedule[e].getDuration()},AdheseVastWrapper.prototype.getDurationInSeconds=function(e){return this.schedule[e].getDurationInSeconds()},AdheseVastWrapper.prototype.track=function(e){for(var t=0;t<e.length;t++)if(!this.trackedImpressions[e[t]]){this.trackedImpressions[e[t]]=1;var r=document.createElement("img");r.src=e[t]+((-1==e[t].indexOf("?")?"?adhche=":"&adhche=")+(new Date).getTime())}},AdheseVastWrapper.prototype.timeupdate=function(e,t){if(this.debug&&console.log(e+" timeupdate @"+t+" sec."),0==t)this.debug&&console.log("Tracking impression for "+e),this.track(this.getImpression(e));else{var r=t/this.schedule[e].getDurationInSeconds();0==r.toFixed(2)?(this.debug&&console.log("Tracking start for "+e),this.track(this.getTrackers(e).start)):.25==r.toFixed(2)?(this.debug&&console.log("Tracking first quartile for "+e+" - "+this.getTrackers(e).firstQuartile),this.track(this.getTrackers(e).firstQuartile)):.5==r.toFixed(2)?(this.debug&&console.log("Tracking mid point for "+e),this.track(this.getTrackers(e).midpoint)):.75==r.toFixed(2)&&(this.debug&&console.log("Tracking third quartile for "+e),this.track(this.getTrackers(e).thirdQuartile))}},AdheseVastWrapper.prototype.clicked=function(e,t){this.debug&&console.log("tracker clicked for "+e+" @"+t),this.debug&&console.log("open new window with VideoClicks>ClickThrough"),this.helper.openNewWindow(this.getClick(e)),this.track(this.getTrackers(e).click)},AdheseVastWrapper.prototype.ended=function(e,t){this.debug&&console.log(e+" ended @"+t),this.debug&&console.log("tracker complete for "+e),this.track(this.getTrackers(e).complete)},AdheseVastAd.prototype.getId=function(){return this.id},AdheseVastAd.prototype.getMediafile=function(){return this.mediafile},AdheseVastAd.prototype.getDuration=function(){return this.duration},AdheseVastAd.prototype.getDurationInSeconds=function(){return this.durationInSeconds},AdheseVastAd.prototype.getImpression=function(){return this.impression},AdheseVastAd.prototype.getTrackers=function(){return this.trackers},AdheseVastAd.prototype.getClick=function(){return this.click},AdheseVastMediaFile.prototype.getSrc=function(){return this.src},AdheseVastMediaFile.prototype.getType=function(){return this.type},AdheseVastEventListener.prototype.getEvent=function(){return this.event},AdheseVastEventListener.prototype.getListener=function(){return this.listener},AdheseVastHelper.prototype.getDurationInSeconds=function(e){if(e){var t=e.split(":");return 3==t.length?parseInt(3600*t[0])+parseInt(60*t[1])+parseInt(t[2]):2==t.length?parseInt(60*t[0])+parseInt(t[1]):1==t.length?parseInt(t[0]):0}return 0},AdheseVastHelper.prototype.openNewWindow=function(e){if(window){var t=window.open(e,"_blank");t.focus()}};var AdheseAjax={request:function(e){"string"==typeof e&&(e={url:e}),e.url=e.url||"",e.method=e.method||"get",e.data=e.data||{};var t=function(e,t){var r,s=[];for(var n in e)s.push(n+"="+encodeURIComponent(e[n]));return r=s.join("&"),""!=r?t?t.indexOf("?")<0?"?"+r:"&"+r:r:""},r={host:{},process:function(e){var r=this;return this.xhr=null,window.ActiveXObject?this.xhr=new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest&&(this.xhr=new XMLHttpRequest),this.xhr&&(this.xhr.onreadystatechange=function(){if(4==r.xhr.readyState&&200==r.xhr.status){var t=r.xhr.responseText;e.json===!0&&"undefined"!=typeof JSON&&(t=JSON.parse(t)),r.doneCallback&&r.doneCallback.apply(r.host,[t,r.xhr])}else 4==r.xhr.readyState&&r.failCallback&&r.failCallback.apply(r.host,[r.xhr]);r.alwaysCallback&&r.alwaysCallback.apply(r.host,[r.xhr])}),"get"==e.method?this.xhr.open("GET",e.url+t(e.data,e.url),!0):(this.xhr.open(e.method,e.url,!0),this.setHeaders({"X-Requested-With":"XMLHttpRequest","Content-type":"application/x-www-form-urlencoded"})),e.headers&&"object"==typeof e.headers&&this.setHeaders(e.headers),setTimeout(function(){"get"==e.method?r.xhr.send():r.xhr.send(t(e.data))},20),this},done:function(e){return this.doneCallback=e,this},fail:function(e){return this.failCallback=e,this},always:function(e){return this.alwaysCallback=e,this},setHeaders:function(e){for(var t in e)this.xhr&&this.xhr.setRequestHeader(t,e[t])}};return r.process(e)}};